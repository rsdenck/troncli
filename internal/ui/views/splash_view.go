package views

import (
	"time"

	"github.com/gdamore/tcell/v2"
	"github.com/rivo/tview"
)

// TRONLogo is the ASCII art for the splash screen
const TRONLogo = `
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
###############+-....--##--....................-########+-....-+#####---+########+----+################ 
###############-.---+---..--+++++++++++++++++++---###+..--+++--..-#+----.-#####-+------################ 
###############-.-----..-------------------------.-+-.-#+-....-+--.--.-+-..+###--..----################ 
################-----------.--+++-------------------.-#-.-+##--.++-.-.+##--.-#+--..----################ 
######################-.---.--###.-------------------#--+######-.+---.+###+---.--.-----################ 
######################-.---.--###.-+#-.--+####+-.-+--#--+######-.+---.+++---...-##+----################ 
######################-.---.--###.-+#-.----##---+##--+#--+###+-.++-.-.-+-.-#+--.-#+----################ 
######################-.---.--###.-+#-.+##---#+---##-.-#+--...-+--.--.-+-.+###---.-----################ 
######################-.---.--###.-++--+###+---+----#+-.-++++---.-#+-.-+-.+####+--.----################ 
#######################-.---#####-.----######+-------###+------+#####---.-########+--.-################ 
####################################################################################################### 
##################################+###########-##+#########--########+###-########+#-################## 
##################################+##########+##+-########---+#######-###+#########-################### 
########################+++#######++++########+++-###########+########++-##########+################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
####################################################################################################### 
#######################################################################################################
`

// SplashView displays the initial splash screen
type SplashView struct {
	*tview.Flex
	app      *tview.Application
	onFinish func()
}

// NewSplashView creates a new SplashView
func NewSplashView(app *tview.Application, onFinish func()) *SplashView {
	v := &SplashView{
		Flex:     tview.NewFlex(),
		app:      app,
		onFinish: onFinish,
	}

	v.setupUI()
	v.startTimer()

	return v
}

func (v *SplashView) setupUI() {
	textView := tview.NewTextView().
		SetTextAlign(tview.AlignCenter).
		SetTextColor(tcell.ColorAqua). // Neon Cyan
		SetText(`
		TRON
	`)

	v.SetDirection(tview.FlexRow).
		AddItem(nil, 0, 1, false).
		AddItem(textView, 35, 1, true). // Fixed height for logo (approx 31 lines)
		AddItem(nil, 0, 1, false)

	// Allow key press to skip
	v.SetInputCapture(func(event *tcell.EventKey) *tcell.EventKey {
		v.onFinish()
		return nil
	})
}

func (v *SplashView) startTimer() {
	go func() {
		time.Sleep(3 * time.Second)
		v.app.QueueUpdateDraw(func() {
			v.onFinish()
		})
	}()
}
